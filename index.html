<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Lamp</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <div id="lamp" style="width:100%;height:100vh;"></div>
  <script>
    // Kích thước
    let base_big = 16, base_small = 8, height = 20;

    // Đỉnh đáy lớn
    let B = [
      [-base_big/2, -base_big/2, 0],
      [ base_big/2, -base_big/2, 0],
      [ base_big/2,  base_big/2, 0],
      [-base_big/2,  base_big/2, 0]
    ];
    // Đỉnh đáy nhỏ
    let S = [
      [-base_small/2, -base_small/2, height],
      [ base_small/2, -base_small/2, height],
      [ base_small/2,  base_small/2, height],
      [-base_small/2,  base_small/2, height]
    ];

    // Các mặt chóp cụt
    let faces = [
      [B[0],B[1],B[2],B[3]],
      [S[0],S[1],S[2],S[3]],
      [B[0],B[1],S[1],S[0]],
      [B[1],B[2],S[2],S[1]],
      [B[2],B[3],S[3],S[2]],
      [B[3],B[0],S[0],S[3]],
    ];

    let lampData = faces.map(f => ({
      type: "mesh3d",
      x: f.map(p => p[0]),
      y: f.map(p => p[1]),
      z: f.map(p => p[2]),
      opacity: 0.5,    // giảm để nhìn xuyên thấy bóng đèn
      color: "lightblue"
    }));

    // ===== Khung nâu =====
    let frame_thickness = 2, frame_height = 1;
    let B_outer = [
      [-base_big/2-frame_thickness, -base_big/2-frame_thickness, 0],
      [ base_big/2+frame_thickness, -base_big/2-frame_thickness, 0],
      [ base_big/2+frame_thickness,  base_big/2+frame_thickness, 0],
      [-base_big/2-frame_thickness,  base_big/2+frame_thickness, 0]
    ];
    let B_outer_top = B_outer.map(([x,y,z]) => [x,y,frame_height]);
    let B_inner_top = B.map(([x,y,z]) => [x,y,frame_height]);

    let frame_faces = [
      B_outer, B_outer_top,
      [B_outer[0],B_outer[1],B_inner_top[1],B_inner_top[0]],
      [B_outer[1],B_outer[2],B_inner_top[2],B_inner_top[1]],
      [B_outer[2],B_outer[3],B_inner_top[3],B_inner_top[2]],
      [B_outer[3],B_outer[0],B_inner_top[0],B_inner_top[3]],
    ];
    frame_faces.forEach(f => lampData.push({
      type: "mesh3d",
      x: f.map(p => p[0]),
      y: f.map(p => p[1]),
      z: f.map(p => p[2]),
      opacity: 0.9,
      color: "saddlebrown"
    }));

    // ===== Bóng đèn vàng (mesh3d sphere) =====
    function createSphere(cx, cy, cz, r, steps=15) {
      let vertices = [];
      let i, j;
      for (i = 0; i <= steps; i++) {
        let theta = i * Math.PI / steps;
        for (j = 0; j <= steps; j++) {
          let phi = j * 2 * Math.PI / steps;
          let x = cx + r * Math.sin(theta) * Math.cos(phi);
          let y = cy + r * Math.sin(theta) * Math.sin(phi);
          let z = cz + r * Math.cos(theta);
          vertices.push([x,y,z]);
        }
      }
      let x = vertices.map(v=>v[0]);
      let y = vertices.map(v=>v[1]);
      let z = vertices.map(v=>v[2]);
      let iArr=[], jArr=[], kArr=[];
      let cols = steps+1;
      for (i = 0; i < steps; i++) {
        for (j = 0; j < steps; j++) {
          let a = i*cols+j;
          let b = a+1;
          let c = a+cols;
          let d = c+1;
          iArr.push(a, a, b, b);
          jArr.push(c, d, c, d);
          kArr.push(b, c, d, a);
        }
      }
      return {x,y,z,i:iArr,j:jArr,k:kArr};
    }

    let bulb = createSphere(0, 0, frame_height+5, 3, 20);

    lampData.push({
      type: "mesh3d",
      x: bulb.x,
      y: bulb.y,
      z: bulb.z,
      i: bulb.i,
      j: bulb.j,
      k: bulb.k,
      color: "gold",
      opacity: 1
    });

    // Vẽ
    Plotly.newPlot("lamp", lampData, {
      scene: {aspectmode: "data"},
      margin: {l:0,r:0,t:0,b:0}
    });
  </script>
</body>
</html>
